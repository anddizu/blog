---
import type { GetStaticPathsOptions, Page } from "astro";
import { getCollection, type CollectionEntry } from "astro:content";
import Pagination from "../../components/pagination.astro";
import PostPreview from "../../components/post-preview.astro";
import siteConfig from "../../data/site-config";
import BaseLayout from "../../layouts/base-layout.astro";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const posts = (await getCollection("blog")).sort(
    (a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
  );
  return paginate(posts, { pageSize: siteConfig.postsPerPage || 4 });
}

type Props = { page: Page<CollectionEntry<"blog">> };

const { page } = Astro.props;
const blog = page.data;
---

<BaseLayout
  title="Blog"
  description="通过我的博客踏上个人见解和经历之旅"
  showHeader={false}
>
  {blog.map((post) => <PostPreview post={post} class="mb-10 sm:mb-12" />)}
  <Pagination page={page} class="my-16 sm:my-24" />
</BaseLayout>
